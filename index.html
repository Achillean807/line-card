<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>LINE é›»å­åç‰‡</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
      background: #f5f5f5;
      overflow-x: hidden;
    }
    .container {
      width: 100vw;
      height: 100vh;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scroll-snap-type: x mandatory;
    }
    .cards-wrapper {
      display: flex;
      height: 100%;
    }
    .card {
      min-width: 100vw;
      height: 100%;
      scroll-snap-align: start;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .card-content {
      width: 100%;
      max-width: 480px;
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      background: white;
    }
    .card-hero {
      padding: 60px 30px 40px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .card-hero::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -30%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 8s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-20px, 20px) rotate(5deg); }
    }
    .avatar {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      border: 5px solid white;
      object-fit: cover;
      margin: 0 auto 24px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }
    .name { font-size: 32px; font-weight: 700; color: white; margin-bottom: 12px; position: relative; z-index: 1; }
    .title { font-size: 18px; color: rgba(255,255,255,0.95); margin-bottom: 8px; position: relative; z-index: 1; }
    .subtitle { font-size: 14px; color: rgba(255,255,255,0.8); position: relative; z-index: 1; }
    .services { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 24px; color: white; }
    .service-item { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.2); font-size: 16px; }
    .service-item:last-child { border-bottom: none; }
    .buttons { padding: 24px; display: flex; flex-direction: column; gap: 12px; }
    .btn {
      display: flex; align-items: center; justify-content: center;
      gap: 8px; padding: 18px; border-radius: 12px; text-decoration: none;
      font-weight: 600; font-size: 16px; transition: transform 0.2s, box-shadow 0.2s;
      color: white; border: none; cursor: pointer; width: 100%;
    }
    .btn:active { transform: scale(0.98); }
    .share-btn {
      position: fixed; bottom: 24px; right: 24px; width: 64px; height: 64px;
      border-radius: 50%; background: #06C755; color: white; border: none;
      font-size: 24px; cursor: pointer; box-shadow: 0 8px 24px rgba(6,199,85,0.4);
      transition: transform 0.2s; z-index: 1000;
    }
    .share-btn:active { transform: scale(0.95); }
    .dots {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 8px; z-index: 1000;
    }
    .dot {
      width: 8px; height: 8px; border-radius: 50%; background: rgba(0,0,0,0.3);
      transition: background 0.3s;
    }
    .dot.active { background: #06C755; width: 24px; border-radius: 4px; }
    .loading {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: white; display: flex; flex-direction: column;
      align-items: center; justify-content: center; z-index: 2000;
      padding: 20px;
    }
    .loading-spinner {
      width: 50px; height: 50px; border: 5px solid #f3f3f3;
      border-top: 5px solid #06C755; border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-text { margin-top: 20px; color: #666; font-size: 16px; text-align: center; }
    .error { 
      color: #E53E3E; 
      margin-top: 20px; 
      font-size: 13px; 
      text-align: center; 
      padding: 15px 20px;
      background: #FEE;
      border-radius: 8px;
      max-width: 90%;
      line-height: 1.5;
    }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div id="loading" class="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">æ­£åœ¨è¼‰å…¥ LIFF SDK...</div>
    <div id="errorMsg" class="error hidden"></div>
  </div>
  
  <div id="container" class="container hidden">
    <div class="cards-wrapper" id="cardsWrapper"></div>
  </div>
  <div id="dots" class="dots hidden"></div>
  <button id="shareBtn" class="share-btn hidden">ğŸ“¤</button>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const CONFIG = {
      liffId: "2008244337-1PXmZeX4",
      cards: [
        {
          id: 1,
          name: "ç§¦å¤©éœ¸",
          title: "æ‘é•·",
          subtitle: "Digital Marketing Consultant",
          image: "https://images.unsplash.com/photo-1560250097-0b93528c311a?w=400&h=400&fit=crop",
          bgColor: "#005BAC",
          buttons: [
            { label: "ğŸ’¬ åŠ å…¥ LINE", url: "https://line.me/ti/p/achillean", color: "#06C755" },
            { label: "ğŸŒ æŸ¥çœ‹ä½œå“é›†", url: "https://www.weddingwishlove.com/category/post_weddingblog/", color: "#4A5568" }
          ]
        },
        {
          id: 2,
          name: "æœå‹™é …ç›®",
          title: "SOLUTIONS",
          subtitle: "æä¾›å…¨æ–¹ä½æ•¸ä½è§£æ±ºæ–¹æ¡ˆ",
          image: "https://images.unsplash.com/photo-1557804506-669a67965ba0?w=400&h=400&fit=crop",
          bgColor: "#1E40AF",
          services: ["å“ç‰Œè¨­è¨ˆèˆ‡ç­–ç•¥", "ç¤¾ç¾¤åª’é«”è¡ŒéŠ·", "ç¶²ç«™é–‹ç™¼å»ºç½®", "æ•¸ä½å»£å‘ŠæŠ•æ”¾"],
          buttons: [
            { label: "ğŸ“ ç«‹å³è«®è©¢", url: "https://line.me/ti/p/~yourlineid", color: "#06C755" }
          ]
        }
      ]
    };

    let currentCardIndex = 0;
    let isLiffInitialized = false;

    function showError(message) {
      document.getElementById("errorMsg").textContent = message;
      document.getElementById("errorMsg").classList.remove("hidden");
      document.querySelector(".loading-text").textContent = "è¼‰å…¥å¤±æ•—";
    }

    function renderCards() {
      const wrapper = document.getElementById("cardsWrapper");
      const dotsContainer = document.getElementById("dots");
      wrapper.innerHTML = "";
      dotsContainer.innerHTML = "";

      CONFIG.cards.forEach((card, index) => {
        const cardEl = document.createElement("div");
        cardEl.className = "card";
        cardEl.dataset.index = index;

        const servicesHtml = card.services
          ? `<div class="services">${card.services.map(s => `<div class="service-item">â€¢ ${s}</div>`).join("")}</div>`
          : "";

        cardEl.innerHTML = `
          <div class="card-content">
            <div class="card-hero" style="background: ${card.bgColor}">
              <img src="${card.image}" alt="${card.name}" class="avatar" onerror="this.src='https://via.placeholder.com/140'">
              <h1 class="name">${card.name}</h1>
              <p class="title">${card.title}</p>
              ${card.subtitle ? `<p class="subtitle">${card.subtitle}</p>` : ""}
            </div>
            ${servicesHtml}
            <div class="buttons">
              ${card.buttons.map(btn => `
                <button class="btn" style="background: ${btn.color}" onclick="openUrl('${btn.url}')">${btn.label}</button>
              `).join("")}
            </div>
          </div>
        `;

        wrapper.appendChild(cardEl);

        const dot = document.createElement("div");
        dot.className = `dot ${index === 0 ? "active" : ""}`;
        dot.dataset.index = index;
        dotsContainer.appendChild(dot);
      });
    }

    function setupScrollListener() {
      const container = document.getElementById("container");
      container.addEventListener("scroll", () => {
        const scrollLeft = container.scrollLeft;
        const cardWidth = window.innerWidth;
        const newIndex = Math.round(scrollLeft / cardWidth);
        if (newIndex !== currentCardIndex) {
          currentCardIndex = newIndex;
          updateDots();
        }
      });
    }

    function updateDots() {
      document.querySelectorAll(".dot").forEach((dot, index) => {
        dot.classList.toggle("active", index === currentCardIndex);
      });
    }

    function setupShareButton() {
      const shareBtn = document.getElementById("shareBtn");
      shareBtn.addEventListener("click", async () => {
        if (!liff.isInClient()) {
          alert("è«‹åœ¨ LINE App ä¸­é–‹å•Ÿæ­¤é é¢æ‰èƒ½ä½¿ç”¨åˆ†äº«åŠŸèƒ½");
          return;
        }
        if (!liff.isApiAvailable("shareTargetPicker")) {
          alert("æ‚¨çš„ LINE ç‰ˆæœ¬ä¸æ”¯æ´åˆ†äº«åŠŸèƒ½");
          return;
        }
        try {
          const messages = CONFIG.cards.map(card => ({
            type: "flex",
            altText: `${card.name} çš„é›»å­åç‰‡`,
            contents: {
              type: "bubble",
              hero: {
                type: "image",
                url: card.image,
                size: "full",
                aspectRatio: "1:1",
                aspectMode: "cover"
              },
              body: {
                type: "box",
                layout: "vertical",
                contents: [
                  { type: "text", text: card.name, weight: "bold", size: "xl", color: "#1a202c" },
                  { type: "text", text: card.title, size: "sm", color: "#718096", margin: "md" }
                ]
              },
              footer: {
                type: "box",
                layout: "vertical",
                contents: card.buttons.map(btn => ({
                  type: "button",
                  style: "primary",
                  action: { type: "uri", label: btn.label.substring(0, 20), uri: btn.url },
                  color: btn.color
                }))
              }
            }
          }));
          const result = await liff.shareTargetPicker(messages);
          if (result) alert("âœ… åç‰‡å·²æˆåŠŸåˆ†äº«ï¼");
        } catch (error) {
          alert("åˆ†äº«å¤±æ•—ï¼š" + error.message);
        }
      });
    }

    function openUrl(url) {
      if (isLiffInitialized && liff.isInClient()) {
        liff.openWindow({ url, external: true });
      } else {
        window.open(url, "_blank");
      }
    }

    function checkLiffReady() {
      return new Promise((resolve, reject) => {
        let attempts = 0;
        const maxAttempts = 100; // 10ç§’
        
        const interval = setInterval(() => {
          attempts++;
          
          if (typeof liff !== 'undefined' && liff.init) {
            clearInterval(interval);
            console.log("âœ… LIFF SDK å·²å°±ç·’");
            resolve();
          } else if (attempts >= maxAttempts) {
            clearInterval(interval);
            reject(new Error("LIFF SDK è¼‰å…¥é€¾æ™‚"));
          }
          
          if (attempts % 10 === 0) {
            console.log(`â³ ç­‰å¾… LIFF SDK... (${attempts}/100)`);
          }
        }, 100);
      });
    }

    async function initLiff() {
      console.log("ğŸ”„ é–‹å§‹åˆå§‹åŒ–...");
      
      try {
        // ç­‰å¾… LIFF SDK è¼‰å…¥
        document.querySelector(".loading-text").textContent = "æ­£åœ¨è¼‰å…¥ LIFF SDK...";
        await checkLiffReady();
        
        // åˆå§‹åŒ– LIFF
        document.querySelector(".loading-text").textContent = "æ­£åœ¨åˆå§‹åŒ– LIFF...";
        console.log("ğŸš€ åˆå§‹åŒ– LIFF API...");
        console.log("ğŸ“Œ LIFF ID:", CONFIG.liffId);
        
        await liff.init({ liffId: CONFIG.liffId });
        
        console.log("âœ… LIFF åˆå§‹åŒ–æˆåŠŸï¼");
        console.log("ğŸ“± åœ¨ LINE ä¸­:", liff.isInClient());
        console.log("ğŸ” å·²ç™»å…¥:", liff.isLoggedIn());
        
        isLiffInitialized = true;
        
        // é¡¯ç¤ºåç‰‡
        renderCards();
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("container").classList.remove("hidden");
        if (CONFIG.cards.length > 1) {
          document.getElementById("dots").classList.remove("hidden");
          setupScrollListener();
        }
        document.getElementById("shareBtn").classList.remove("hidden");
        setupShareButton();
        
      } catch (error) {
        console.error("âŒ åˆå§‹åŒ–å¤±æ•—:", error);
        
        let errorMsg = "è¼‰å…¥å¤±æ•—\n\n";
        
        if (error.message && error.message.includes("é€¾æ™‚")) {
          errorMsg += "LIFF SDK ç„¡æ³•è¼‰å…¥\n\n";
          errorMsg += "è«‹æª¢æŸ¥ï¼š\n";
          errorMsg += "1. ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸\n";
          errorMsg += "2. æ˜¯å¦åœ¨ LINE App ä¸­é–‹å•Ÿ\n";
          errorMsg += "3. å˜—è©¦é‡æ–°æ•´ç†é é¢";
        } else if (error.code === "400") {
          errorMsg += "LIFF è¨­å®šéŒ¯èª¤\n\n";
          errorMsg += "è«‹ç¢ºèª LINE Developers Console ä¸­ï¼š\n";
          errorMsg += "â€¢ LIFF ID æ˜¯å¦æ­£ç¢º\n";
          errorMsg += "â€¢ Endpoint URL è¨­ç‚º:\n";
          errorMsg += "  https://line-card.vercel.app";
        } else {
          errorMsg += error.message || "æœªçŸ¥éŒ¯èª¤";
          errorMsg += "\n\nè«‹å˜—è©¦é‡æ–°æ•´ç†é é¢";
        }
        
        showError(errorMsg);
      }
    }

    // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLiff);
    } else {
      setTimeout(initLiff, 100);
    }
  </script>
</body>
</html>